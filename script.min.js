const urlHost=window.location.href.substr(0,window.location.href.lastIndexOf("/"));let inputTextByConvert="";const extension={asciidoc_legacy:"asciidoc",asciidoc:"asciidoc",beamer:"tex",biblatex:"bib",bibtex:"bibtex",chunkedhtml:"zip",commonmark_x:"md",commonmark:"md",context:"tex",creole:"txt",csljson:"json",csv:"csv",docbook5:"xml",docbook:"xml",docx:"docx",dokuwiki:"txt",dzslides:"html",endnotexml:"xml",epub2:"epub",epub3:"epub",epub:"epub",fb2:"fb2",gfm:"md",haddock:"md",html4:"html",html5:"html",html:"html",icml:"icml",ipynb:"ipynb",jats_archiving:"xml",jats_articleauthoring:"xml",jats_publishing:"xml",jats:"xml",jira:"txt",json:"json",latex:"tex",man:"man",markdown_mmd:"md",markdown_phpextra:"md",markdown_strict:"md",markdown:"md",markua:"md",mediawiki:"txt",ms:"ms",muse:"txt",native:"hs",odt:"odt",opendocument:"odf",opml:"xml",org:"txt",pdf:"pdf",plain:"txt",pptx:"pptx",preview:"html",revealjs:"html",ris:"ris",rst:"rst",rtf:"rtf",s5:"html",slideous:"html",slidy:"html",t2t:"t2t",tei:"tei",texinfo:"texi",textile:"textile",tikiwiki:"txt",tsv:"tsv",twiki:"txt",typst:"typ",vimwiki:"txt",xwiki:"txt",zimwiki:"txt"};function pandoc(e){var t=urlHost+"/pandoc.php",n=document.getElementById("standalone").checked,o=document.getElementById("table-of-contents").checked,d=document.getElementById("number-sections").checked,l=document.getElementById("citeproc").checked,i=document.getElementById("wrap").value,m=document.getElementById("highlight-style").value,u=document.getElementById("html-math-method").value,c=document.getElementById("cb-inputfile").checked,s=extension[document.getElementById("from").value];if(c||"docx"!=s&&"epub"!=s&&"odt"!=s){var a=!1;if(c&&(a=document.getElementById("inputfile").files[0]),a||!c){var r=document.getElementById("cb-outputfile").checked,p=extension[document.getElementById("to").value],g=document.getElementById("from").value;if("none"!==g){var b=document.getElementById("to").value,y=document.getElementById("input").innerText;if(inputTextByConvert=y,!isEmpty(y)||c){var h=new FormData;h.set("standalone",n),h.set("tableOfContents",o),h.set("numberSections",d),h.set("citeproc",l),h.set("wrap",i),h.set("highlightStyle",m),h.set("htmlMathMethod",u),h.set("useInputFile",c),h.set("inputFileExtension",s),h.set("inputFile",a),h.set("useOutputFile",r),h.set("outputFileExtension",p),h.set("from",g),h.set("to",b),h.set("input",y),pushDialog("Converting with pandoc","busy"),fetch(t,{method:"POST",body:h}).then((e=>{if(!e.ok)throw new Error("HTTP error "+e.status);return r?e.blob():e.text()})).then((e=>{if(r){let t=new Blob([e],{type:"text/plain"}),n=document.getElementById("download");n.href=URL.createObjectURL(t);let o=(new Date).toISOString().replaceAll("T","_").replaceAll(":","-").slice(0,19);n.setAttribute("download","output_"+o+"."+p),document.getElementById("download").innerText="Download output_"+o+"."+p,dialog.close()}else{if("preview"===b)document.getElementById("output").innerHTML=e;else{document.getElementById("output").innerHTML="";var t=document.createElement("pre");document.getElementById("output").appendChild(t),t.innerText=e}setMainButtonsAppearance(),dialog.close()}})).catch((e=>{dialog.close(),pushDialog("Error fetching pandoc output: "+e,"error")}))}else!0===e&&pushDialog("Error: Nothing to convert.\n\nYou must either write something into the 'Input field' or select a file as input in the 'Options'.","error")}else!0===e&&pushDialog("Error: You must select an input format in the 'From' pulldown menu.","error","from")}else!0===e&&pushDialog("Error: Nothing to convert.\nYou must select a file as input.","error","inputfile")}else!0===e&&(document.getElementById("options").setAttribute("open","open"),document.getElementById("cb-inputfile").checked=!0,checkInputFile(),pushDialog("Error: For conversion from '"+s+"' you must select a file as input.","error","inputfile"))}function toggleStandalone(){!0===document.getElementById("table-of-contents").checked&&(document.getElementById("standalone").checked=!0)}function toggleToc(){!1===document.getElementById("standalone").checked&&(document.getElementById("table-of-contents").checked=!1)}function setMainButtonsAppearance(){const e=document.getElementById("convert"),t=document.getElementById("copy"),n=document.getElementById("from").value,o=document.getElementById("cb-inputfile").checked;let d=!1;o&&(d=document.getElementById("inputfile").files[0]);const l=document.getElementById("input").innerText,i=document.getElementById("output");"none"===n||!d&&o?e.setAttribute("disabled","disabled"):isEmpty(l)&&!o?(e.setAttribute("disabled","disabled"),i.innerText=""):l===inputTextByConvert?e.setAttribute("disabled","disabled"):e.removeAttribute("disabled");const m=document.getElementById("output").innerText;void 0===m||isEmpty(m)?t.setAttribute("disabled","disabled"):t.removeAttribute("disabled")}function checkInputFile(){!0===document.getElementById("cb-inputfile").checked?(document.getElementById("inputfile").removeAttribute("disabled"),document.getElementById("input").removeAttribute("contenteditable"),document.getElementById("input").classList.add("disabled"),document.getElementById("label-inputfield").classList.add("disabled"),document.getElementById("output").innerText=""):(document.getElementById("inputfile").setAttribute("disabled","disabled"),document.getElementById("input").setAttribute("contenteditable","true"),document.getElementById("input").classList.remove("disabled"),document.getElementById("label-inputfield").classList.remove("disabled"))}function checkOutputFile(){!0===document.getElementById("cb-outputfile").checked?(document.getElementById("download").setAttribute("href","#"),document.getElementById("copy").setAttribute("disabled","disabled"),document.getElementById("output").classList.add("disabled"),document.getElementById("output").innerText="",document.getElementById("label-outputfield").classList.add("disabled")):(document.getElementById("download").removeAttribute("href"),document.getElementById("download").innerText="",document.getElementById("copy").removeAttribute("disabled"),document.getElementById("output").classList.remove("disabled"),document.getElementById("label-outputfield").classList.remove("disabled"))}function serializeElement(e){return e.outerHTML}async function copyOutput(){var e=document.getElementById("output");const t=serializeElement(e),n=new Blob([t],{type:"text/html"}),o=e.innerText??"",d=new Blob([o],{type:"text/plain"}),l=new ClipboardItem({[n.type]:n,[d.type]:d});return navigator.clipboard.write([l])}function pushDialog(e,t,n){var o=document.getElementById("dialogText");o.innerText=e,"error"===t?(document.getElementById("dialog").classList.add("error-dialog"),document.getElementById("dialog").classList.remove("busy-dialog"),o.role="alert",void 0!==n&&document.getElementById(n).focus()):"busy"===t&&(document.getElementById("dialog").classList.remove("error-dialog"),document.getElementById("dialog").classList.add("busy-dialog")),dialog.showModal()}function isEmpty(e){return 0===e.length||!e.trim()}function useExample(){document.getElementById("input").innerText=example,document.getElementById("from").value="markdown",document.getElementById("cb-inputfile").checked=!1,checkInputFile(),pandoc()}